# Sceneforged Configuration Example
#
# This file documents all available configuration options.
# Copy this file to config.toml and modify as needed.

# ============================================================================
# Server Configuration
# ============================================================================
# Configure the web server that provides the UI and API endpoints.

[server]
# IP address to bind to (default: "0.0.0.0" - all interfaces)
host = "0.0.0.0"

# Port to listen on (default: 8080)
port = 8080

# Path to static files for the web UI (optional)
# static_dir = "./ui/build"

# ============================================================================
# Authentication Configuration
# ============================================================================
# Configure authentication for the API and web UI.
# Generate password hash with: sceneforged hash-password <password>
# Generate API key with: sceneforged generate-api-key

[server.auth]
# Enable authentication (default: false)
enabled = false

# API key for programmatic access (used with Authorization: Bearer header)
# api_key = "your-api-key-here"

# Username and password for web UI login
# username = "admin"
# password_hash = "$2b$12$..."  # Run: sceneforged hash-password <password>

# Session timeout in hours (default: 24)
session_timeout_hours = 24

# ============================================================================
# Webhook Security Configuration
# ============================================================================
# Configure security for incoming webhooks.
# Generate secret with: sceneforged generate-secret

[server.webhook_security]
# Enable webhook signature verification (default: false)
signature_verification = false

# Shared secret for HMAC-SHA256 signature verification
# The signature should be sent in the X-Sceneforged-Signature header as: sha256=<hex>
# signature_secret = "your-secret-here"

# Allowed IP addresses or CIDR ranges (empty = allow all)
# allowed_ips = ["192.168.1.0/24", "10.0.0.0/8"]

# ============================================================================
# File Watching Configuration
# ============================================================================
# Configure automatic file watching and processing.

[watch]
# Enable or disable file watching (default: false)
enabled = true

# Directories to watch for new media files
paths = ["/media/movies", "/media/tv"]

# Time to wait (in seconds) after a file stops changing before processing
# This prevents processing files that are still being written
settle_time_secs = 30

# File extensions to process (case-insensitive)
extensions = ["mkv", "mp4", "avi"]

# ============================================================================
# Arr Integration (Radarr/Sonarr)
# ============================================================================
# Configure integration with *arr applications for media library management.

# Radarr integration
[[arrs]]
name = "radarr"
type = "radarr"
url = "http://localhost:7878"
api_key = "your-api-key-here"
enabled = false
# Trigger a rescan in Radarr after processing completes (default: true)
auto_rescan = true
# Rename files according to Radarr's naming settings after processing (default: false)
auto_rename = false

# Sonarr integration
[[arrs]]
name = "sonarr"
type = "sonarr"
url = "http://localhost:8989"
api_key = "your-api-key-here"
enabled = false
# Trigger a rescan in Sonarr after processing completes (default: true)
auto_rescan = true
# Rename files according to Sonarr's naming settings after processing (default: false)
auto_rename = false

# You can add multiple instances:
# [[arrs]]
# name = "radarr-4k"
# type = "radarr"
# url = "http://localhost:7879"
# api_key = "your-4k-api-key-here"
# enabled = true
# auto_rescan = true

# ============================================================================
# Jellyfin Integration
# ============================================================================
# Configure Jellyfin media server notifications. After a job completes,
# Sceneforged can trigger a library refresh so Jellyfin picks up changes.

[[jellyfins]]
name = "jellyfin"
url = "http://localhost:8096"
api_key = "your-jellyfin-api-key-here"
enabled = false

# You can add multiple Jellyfin instances:
# [[jellyfins]]
# name = "jellyfin-4k"
# url = "http://localhost:8097"
# api_key = "your-4k-jellyfin-api-key"
# enabled = true

# ============================================================================
# Conversion Settings
# ============================================================================
# Configure automatic conversion behavior.

[conversion]
# Automatically convert Dolby Vision Profile 7 files to Profile 8 on import.
# Profile 8 provides better compatibility with Infuse and other players.
# Default: false (manual conversion only)
auto_convert_dv_p7_to_p8 = false

# ============================================================================
# External Tools Configuration
# ============================================================================
# Specify custom paths for required external tools.
# If not specified, sceneforged will search for these in your PATH.

[tools]
# FFmpeg - for transcoding and audio conversion
# ffmpeg_path = "/usr/local/bin/ffmpeg"

# FFprobe - for media analysis
# ffprobe_path = "/usr/local/bin/ffprobe"

# MediaInfo - for detailed media information
# mediainfo_path = "/usr/local/bin/mediainfo"

# MKVMerge - for remuxing to MKV container
# mkvmerge_path = "/usr/local/bin/mkvmerge"

# dovi_tool - for Dolby Vision metadata manipulation
# dovi_tool_path = "/usr/local/bin/dovi_tool"

# ============================================================================
# Processing Rules
# ============================================================================
# Define rules for automatic media processing. Rules are evaluated in priority
# order (higher priority first). Each rule can match on various media
# properties and apply one or more actions.

# Rule: Convert Dolby Vision Profile 7 to Profile 8.1
# This allows compatibility with devices that don't support Profile 7
[[rules]]
name = "dv_p7_to_p8"
enabled = true
priority = 100

[rules.match]
dolby_vision_profiles = [7]

[[rules.actions]]
type = "dv_convert"
target_profile = 8

# Rule: Remux AVI files to MKV
# AVI is an outdated container; MKV provides better compatibility
[[rules]]
name = "avi_to_mkv"
enabled = true
priority = 50

[rules.match]
containers = ["avi"]

[[rules.actions]]
type = "remux"
container = "mkv"
keep_original = false

# ============================================================================
# Additional Rule Examples (commented out)
# ============================================================================

# Example: Add compatibility audio track for TrueHD
# [[rules]]
# name = "truehd_compat_audio"
# enabled = true
# priority = 80
#
# [rules.match]
# audio_codecs = ["truehd"]
#
# [[rules.actions]]
# type = "add_compat_audio"
# source_codec = "truehd"
# target_codec = "aac"

# Example: Strip unwanted audio/subtitle tracks
# [[rules]]
# name = "strip_extra_tracks"
# enabled = true
# priority = 30
#
# [rules.match]
# containers = ["mkv", "mp4"]
#
# [[rules.actions]]
# type = "strip_tracks"
# track_types = ["audio", "subtitle"]
# languages = ["fra", "deu", "spa"]  # Keep only English, remove these

# Example: Match by resolution and codec
# [[rules]]
# name = "4k_hevc_processing"
# enabled = true
# priority = 75
#
# [rules.match]
# codecs = ["hevc", "h265"]
# min_resolution = { width = 3840, height = 2160 }
# hdr_formats = ["hdr10", "hdr10+"]
#
# [[rules.actions]]
# type = "exec"
# command = "/path/to/custom/script.sh"
# args = ["--input", "{input_file}", "--output", "{output_file}"]
